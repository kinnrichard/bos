<!DOCTYPE html>
<html>
<head>
    <title>Avatar Display Test</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            padding: 40px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            max-width: 600px;
            margin: 0 auto;
        }
        h1 {
            font-size: 24px;
            margin-bottom: 20px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 4px;
        }
        .test-section h2 {
            font-size: 18px;
            margin-bottom: 15px;
            color: #333;
        }
        .avatar-display {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        .status-label {
            color: #666;
            font-size: 14px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background: #0056b3;
        }
        .result {
            margin-top: 15px;
            padding: 10px;
            background: #e8f5e9;
            border-radius: 4px;
            font-size: 14px;
        }
        .error {
            background: #ffebee;
            color: #c62828;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Avatar Display Fix Verification</h1>
        
        <div class="test-section">
            <h2>Test 1: Creating Avatar with JavaScript</h2>
            <p class="status-label">This tests the fixed UserDisplay.createUserAvatarElement function:</p>
            <div id="test1-result" class="avatar-display"></div>
            <button onclick="testAvatarCreation()">Create Test Avatar</button>
        </div>

        <div class="test-section">
            <h2>Test 2: Avatar Style Verification</h2>
            <p class="status-label">Click to verify all styles are properly applied:</p>
            <div id="test2-result" class="avatar-display"></div>
            <button onclick="verifyAvatarStyles()">Verify Avatar Styles</button>
            <div id="style-results"></div>
        </div>
    </div>

    <script type="module">
        // Import the UserDisplay module
        import * as UserDisplay from './app/javascript/bos/user_display.js';
        
        window.testAvatarCreation = function() {
            const container = document.getElementById('test1-result');
            container.innerHTML = '';
            
            // Create test users
            const users = [
                { id: 1, name: 'Jake Brown' },
                { id: 2, name: 'Sarah Smith' },
                { id: 3, name: 'Bob' }
            ];
            
            users.forEach(user => {
                const avatar = UserDisplay.createUserAvatarElement(user, 'sm');
                container.appendChild(avatar);
            });
            
            const result = document.createElement('div');
            result.className = 'result';
            result.textContent = '✓ Avatars created successfully';
            container.appendChild(result);
        };
        
        window.verifyAvatarStyles = function() {
            const container = document.getElementById('test2-result');
            const resultsDiv = document.getElementById('style-results');
            container.innerHTML = '';
            resultsDiv.innerHTML = '';
            
            // Create a test avatar
            const avatar = UserDisplay.createUserAvatarElement(
                { id: 1, name: 'Test User' },
                'sm'
            );
            container.appendChild(avatar);
            
            // Check computed styles
            const styles = window.getComputedStyle(avatar);
            const expectedStyles = {
                'display': 'inline-flex',
                'border-radius': '50%',
                'width': '24px',
                'height': '24px',
                'color': 'rgb(255, 255, 255)',
                'font-weight': '600',
                'text-transform': 'uppercase'
            };
            
            let allPassed = true;
            const results = document.createElement('div');
            results.className = 'result';
            
            Object.entries(expectedStyles).forEach(([property, expected]) => {
                const actual = styles.getPropertyValue(property);
                const passed = actual === expected;
                if (!passed) allPassed = false;
                
                const line = document.createElement('div');
                line.innerHTML = `${passed ? '✓' : '✗'} ${property}: ${actual} ${passed ? '' : `(expected: ${expected})`}`;
                line.style.color = passed ? 'green' : 'red';
                results.appendChild(line);
            });
            
            if (allPassed) {
                results.classList.remove('error');
                const summary = document.createElement('div');
                summary.innerHTML = '<strong>All styles verified successfully!</strong>';
                summary.style.marginTop = '10px';
                results.appendChild(summary);
            } else {
                results.classList.add('error');
            }
            
            resultsDiv.appendChild(results);
        };
    </script>
</body>
</html>